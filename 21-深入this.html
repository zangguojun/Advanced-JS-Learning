<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>深入this</title>
  <style>
    html,
    body {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
  <!-- 1 -->
  <script>
    {
      let a = 12;
      console.log(this, '[object Window]');
    }
    console.log(this.a, undefined);
  </script>
  <!-- 2 -->
  <script>
    var obj = {
      fn() {
        {
          let a = 12;
          console.log(this, '{obj}');
        }
        console.log(this.a, undefined);
      }
    }
    obj.fn()
  </script>
  <!-- 3 -->
  <script>
    // DOM0
    document.body.onclick = function () {
      console.log(this);
    }

    // 高版本浏览器DOM2
    document.body.addEventListener('click', function () {
      console.log(this);
    })

    // 低版本浏览器DOM2
    // document.body.attachEvent('onclick', function () {
    //   console.log(this);
    // })
  </script>
  <!-- 4 -->
  <script>
      (function () {
        console.log(this, '[object Window]');
      })();

    console.log('--------------------');

    'use strict';
    (function () {
      'use strict'
      console.log(this, undefined);
    })();

    console.log('--------------------');

    var obj = {
      fn: (function () {
        console.log(this, '[object Window]');
        return function () {
        }
      })()
    }
  </script>
  <!-- 5 -->
  <script>
    function func() {
      console.log(this);
    }
    var obj = {
      func: func
    }
    func() // '[object Window]'
    obj.func()// obj
  </script>
  <!-- 6 -->
  <script>
    /*
      [1].slice()
      //slice方法执行，slice里的this是[1]
      Array.prototype.slice()
      //slice方法执行，slice里的this是Array.prototype
      [1].__proto__.slice()
      //slice方法执行，slice里的this是[1].__proto__ === Array.prototype
    */
  </script>
  <!-- 7 -->
  <script>
    console.log('--------------------');
    function func() {
      console.log(this, '[object Window]');
    }
    document.body.onclick = function () {
      func();
      // func方法执行，func里的this是window
    }
  </script>
  <!-- 8 -->
  <script>
    console.log('--------------------');
    function Func() {
      this.name = 'F'
      console.log(this, '[object Window]');
    }
    Func.prototype.getName = function () {
      console.log(this);
    }
    let f = new Func() // '[object Func]'
    f.getName() // '[object Func]'
    f.__proto__.getName() // '[object Func.prototype]'
    Func.prototype.getName() // '[object Func.prototype]'
    let gN = f.getName
    gN()//'[object Window]'
  </script>
  <!-- 9 -->
  <script>
    console.log('--------------------');
    var obj = {
      func: function () {
        console.log(this);
      },
      sum: () => {
        console.log(this);
      }
    }
    var obj2 = {
      1: 2
    }
    obj.func() // '{object obj}'
    obj.sum() // 箭头函数的this的当前所在上下文【此时在ECG中执行】中的this就是'[object Window]'
    obj.func.call(obj2) // '{object obj2}'
    obj.sum.call(obj2) // 箭头函数没有自己的this，所以无法修改
  </script>
  <!-- 10 -->
  <script>
    var obj = {
      i: 0,
      func() {
        _this = this
        setTimeout(function () {
          console.log(_this.i);
          _this.i++
          console.log(_this.i);
          console.log(obj);
        }, 1000);
      }
    }
    obj.func()

    console.log('--------------------');

    var obj = {
      i: 0,
      func() {
        setTimeout(function () {
          console.log(this.i);
          this.i++
          console.log(this.i);
          console.log(obj);
        }, 1000);
      }
    }
    obj.func()

    console.log('--------------------');

    var obj = {
      i: 0,
      func() {
        setTimeout(function () {
          console.log(this.i);
          this.i++
          console.log(this.i);
          console.log(obj);
        }.bind(this), 1000);
      }
    }
    obj.func()

    console.log('--------------------');

    var obj = {
      i: 0,
      func() {
        setTimeout(() => {
          this.i++
          console.log(obj);
        }, 1000);
      }
    }
    obj.func()
  </script>
  <!-- 11 -->
  <script>
    var num = 10;
    var obj = {
      num: 20
    };
    obj.fn = (function (num) {// 20  10
      this.num = num * 3;     // 60  60
      num++;                  // 21  21
      return function (n) {
        this.num += n;        // 65  30
        num++;                // 22  23
        console.log(num);     // 22  23
      }
    })(obj.num);
    var fn = obj.fn;
    fn(5); // 22
    obj.fn(10);
    console.log(num, obj.num);// 65 30
  </script>
</body>

</html>